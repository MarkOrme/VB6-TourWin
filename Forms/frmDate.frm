VERSION 5.00
Begin VB.Form frmDate 
   BorderStyle     =   4  'Fixed ToolWindow
   Caption         =   " "
   ClientHeight    =   2490
   ClientLeft      =   45
   ClientTop       =   285
   ClientWidth     =   2565
   BeginProperty Font 
      Name            =   "Tahoma"
      Size            =   8.25
      Charset         =   0
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   Icon            =   "frmDate.frx":0000
   KeyPreview      =   -1  'True
   LinkTopic       =   "Form1"
   LockControls    =   -1  'True
   MaxButton       =   0   'False
   MinButton       =   0   'False
   ScaleHeight     =   2490
   ScaleWidth      =   2565
   ShowInTaskbar   =   0   'False
   StartUpPosition =   3  'Windows Default
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      ForeColor       =   &H00000000&
      Height          =   285
      Index           =   41
      Left            =   2160
      Locked          =   -1  'True
      TabIndex        =   50
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   2160
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   40
      Left            =   1800
      Locked          =   -1  'True
      TabIndex        =   49
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   2160
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   39
      Left            =   1440
      Locked          =   -1  'True
      TabIndex        =   48
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   2160
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   38
      Left            =   1080
      Locked          =   -1  'True
      TabIndex        =   47
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   2160
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   37
      Left            =   720
      Locked          =   -1  'True
      TabIndex        =   46
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   2160
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   36
      Left            =   360
      Locked          =   -1  'True
      TabIndex        =   45
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   2160
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   35
      Left            =   0
      Locked          =   -1  'True
      TabIndex        =   44
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   2160
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   34
      Left            =   2160
      Locked          =   -1  'True
      TabIndex        =   43
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1845
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   33
      Left            =   1800
      Locked          =   -1  'True
      TabIndex        =   42
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1845
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   32
      Left            =   1440
      Locked          =   -1  'True
      TabIndex        =   41
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1845
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   31
      Left            =   1080
      Locked          =   -1  'True
      TabIndex        =   40
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1845
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   30
      Left            =   720
      Locked          =   -1  'True
      TabIndex        =   39
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1845
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   29
      Left            =   360
      Locked          =   -1  'True
      TabIndex        =   38
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1845
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   28
      Left            =   0
      Locked          =   -1  'True
      TabIndex        =   37
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1845
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   27
      Left            =   2160
      Locked          =   -1  'True
      TabIndex        =   36
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1550
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   26
      Left            =   1800
      Locked          =   -1  'True
      TabIndex        =   35
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1550
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   25
      Left            =   1440
      Locked          =   -1  'True
      TabIndex        =   34
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1550
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   24
      Left            =   1080
      Locked          =   -1  'True
      TabIndex        =   33
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1550
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   23
      Left            =   720
      Locked          =   -1  'True
      TabIndex        =   32
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1550
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   22
      Left            =   360
      Locked          =   -1  'True
      TabIndex        =   31
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1550
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   21
      Left            =   0
      Locked          =   -1  'True
      TabIndex        =   30
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1550
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   20
      Left            =   2160
      Locked          =   -1  'True
      TabIndex        =   29
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1235
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   19
      Left            =   1800
      Locked          =   -1  'True
      TabIndex        =   28
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1235
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   18
      Left            =   1440
      Locked          =   -1  'True
      TabIndex        =   27
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1235
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   17
      Left            =   1080
      Locked          =   -1  'True
      TabIndex        =   26
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1235
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   16
      Left            =   720
      Locked          =   -1  'True
      TabIndex        =   25
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1235
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   15
      Left            =   360
      Locked          =   -1  'True
      TabIndex        =   24
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1235
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   14
      Left            =   0
      Locked          =   -1  'True
      TabIndex        =   23
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   1235
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   13
      Left            =   2160
      Locked          =   -1  'True
      TabIndex        =   22
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   960
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   12
      Left            =   1800
      Locked          =   -1  'True
      TabIndex        =   21
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   960
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   11
      Left            =   1440
      Locked          =   -1  'True
      TabIndex        =   20
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   960
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   10
      Left            =   1080
      Locked          =   -1  'True
      TabIndex        =   19
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   960
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   9
      Left            =   720
      Locked          =   -1  'True
      TabIndex        =   18
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   960
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   8
      Left            =   360
      Locked          =   -1  'True
      TabIndex        =   17
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   960
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   7
      Left            =   0
      Locked          =   -1  'True
      TabIndex        =   16
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   960
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   6
      Left            =   2160
      Locked          =   -1  'True
      TabIndex        =   15
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   720
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   5
      Left            =   1800
      Locked          =   -1  'True
      TabIndex        =   14
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   720
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   4
      Left            =   1440
      Locked          =   -1  'True
      TabIndex        =   13
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   720
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   3
      Left            =   1080
      Locked          =   -1  'True
      TabIndex        =   12
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   720
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   2
      Left            =   720
      Locked          =   -1  'True
      TabIndex        =   11
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   720
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   1
      Left            =   360
      Locked          =   -1  'True
      TabIndex        =   10
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   720
      Width           =   300
   End
   Begin VB.TextBox txtDays 
      Alignment       =   1  'Right Justify
      BackColor       =   &H8000000B&
      BorderStyle     =   0  'None
      Height          =   285
      Index           =   0
      Left            =   0
      Locked          =   -1  'True
      TabIndex        =   9
      TabStop         =   0   'False
      Text            =   "Text1"
      Top             =   720
      Width           =   300
   End
   Begin VB.ComboBox cboYear 
      Height          =   315
      Left            =   1560
      Style           =   2  'Dropdown List
      TabIndex        =   1
      Top             =   60
      Width           =   975
   End
   Begin VB.ComboBox cboMonth 
      Height          =   315
      ItemData        =   "frmDate.frx":000C
      Left            =   120
      List            =   "frmDate.frx":0034
      Style           =   2  'Dropdown List
      TabIndex        =   0
      Top             =   60
      Width           =   1215
   End
   Begin VB.Label lblLabel 
      Alignment       =   1  'Right Justify
      Caption         =   "S"
      ForeColor       =   &H000000FF&
      Height          =   300
      Index           =   6
      Left            =   2160
      TabIndex        =   8
      Top             =   450
      Width           =   300
   End
   Begin VB.Label lblLabel 
      Alignment       =   1  'Right Justify
      Caption         =   "F"
      Height          =   300
      Index           =   5
      Left            =   1800
      TabIndex        =   7
      Top             =   450
      Width           =   300
   End
   Begin VB.Label lblLabel 
      Alignment       =   1  'Right Justify
      Caption         =   "T"
      Height          =   300
      Index           =   4
      Left            =   1440
      TabIndex        =   6
      Top             =   450
      Width           =   300
   End
   Begin VB.Label lblLabel 
      Alignment       =   1  'Right Justify
      Caption         =   "W"
      Height          =   300
      Index           =   3
      Left            =   1080
      TabIndex        =   5
      Top             =   450
      Width           =   300
   End
   Begin VB.Label lblLabel 
      Alignment       =   1  'Right Justify
      Caption         =   "T"
      Height          =   300
      Index           =   2
      Left            =   720
      TabIndex        =   4
      Top             =   450
      Width           =   300
   End
   Begin VB.Label lblLabel 
      Alignment       =   1  'Right Justify
      Caption         =   "M"
      Height          =   300
      Index           =   1
      Left            =   360
      TabIndex        =   3
      Top             =   450
      Width           =   300
   End
   Begin VB.Label lblLabel 
      Alignment       =   1  'Right Justify
      Caption         =   "S"
      ForeColor       =   &H000000FF&
      Height          =   300
      Index           =   0
      Left            =   0
      TabIndex        =   2
      Top             =   450
      Width           =   300
   End
End
Attribute VB_Name = "frmDate"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit
Private Declare Function SendMessage Lib "user32" Alias "SendMessageA" (ByVal hwnd As Long, ByVal wMsg As Long, ByVal wParam As Long, lParam As Any) As Long
Private m_result As Long
Private m_loading As Boolean
Private m_day As Long
Private m_date As Date
Private m_tabstop As Long

Const USERCANCELLED = 0
Const USERSELECTEDDATE = 1

Private Sub cboMonth_Click()
Dim dDate As Date
Dim ThisDate As Variant
Dim LastDay As Long
On Local Error GoTo Month_Error


If m_loading Then Exit Sub

If MaxDay > 28 Then
    Select Case cboMonth.ListIndex
            Case 1, 3, 5, 8, 10:
                dDate = CDate(cboYear.Text & "-" & cboMonth.Text & "-01")
                ThisDate = DateValue(dDate)
                LastDay = Day(MonthEnd(ThisDate))
                
                If MaxDay > LastDay Then
                    dDate = CDate(cboYear.Text & "-" & cboMonth.Text & "-" & CStr(LastDay))
                Else
                    dDate = CDate(cboYear.Text & "-" & cboMonth.Text & "-" & CStr(MaxDay))
                End If
            
            Case Else:
            dDate = CDate(cboYear.Text & "-" & cboMonth.Text & "-" & CStr(MaxDay))
    End Select
Else
    dDate = CDate(cboYear.Text & "-" & cboMonth.Text & "-" & CStr(MaxDay))
End If

UpdateCalendar (dDate)

Exit Sub
Month_Error:
Err.Clear
End Sub


Private Sub cboYear_Click()
Dim dDate As Date

If m_loading Then Exit Sub
dDate = CDate(cboYear.Text & "-" & cboMonth.Text & "-" & m_day)

UpdateCalendar (dDate)

End Sub

Private Sub Form_Activate()
    
    SetFocusToDay
End Sub

Private Sub Form_Click()
    SelectionResult = USERCANCELLED
    Me.Hide
End Sub

Private Sub Form_KeyUp(KeyCode As Integer, Shift As Integer)

If KeyCode = vbKeyEscape Then

    SelectionResult = USERCANCELLED
    Me.Hide
End If

End Sub

Private Sub Form_Load()
Dim lLoop As Long
m_loading = True

    cboYear.Clear
    For lLoop = 1922 To 2121
        cboYear.AddItem CStr(lLoop)
    Next
    For lLoop = txtDays.LBound To txtDays.UBound
        txtDays(lLoop).Text = ""
    Next
    ' Default setting
    SelectionResult = USERCANCELLED
End Sub

Private Sub txtDays_Click(Index As Integer)
If m_loading Then Exit Sub
If txtDays(Index).Text = "" Then Exit Sub
    
If &H808080 = txtDays(Index).ForeColor Then
    MovePreviousOrNextMonth Index, 0
    
Else

    SelectionResult = USERSELECTEDDATE
    MaxDate = CDate(cboYear.Text & "-" & cboMonth.Text & "-" & MaxDay)
    Me.Hide

End If
End Sub

Private Sub txtDays_GotFocus(Index As Integer)

Dim iLoop As Long
If m_loading Then Exit Sub

If txtDays(Index).Text = "" Then Exit Sub
If Index = tabstopindex Then Exit Sub
txtDays(tabstopindex).BorderStyle = 0
txtDays(tabstopindex).TabStop = False

txtDays(Index).BorderStyle = 1
txtDays(Index).TabStop = True
tabstopindex = Index

MaxDay = CLng(txtDays(Index).Text)

UpdateCaption

End Sub

Private Sub txtDays_KeyPress(Index As Integer, KeyAscii As Integer)

If 13 = KeyAscii Then
    SelectionResult = USERSELECTEDDATE
    MaxDate = CDate(cboYear.Text & "-" & cboMonth.Text & "-" & MaxDay)
    Me.Hide
End If

End Sub

Private Sub txtDays_KeyUp(Index As Integer, KeyCode As Integer, Shift As Integer)
On Local Error Resume Next
Dim dDate As Date
Select Case KeyCode
        Case vbKeyRight:
            If &H808080 = txtDays(Index + 1).ForeColor Then
                MovePreviousOrNextMonth Index, 1
            Else
                txtDays(Index + 1).SetFocus
            End If
            
        Case vbKeyDown:
            If &H808080 = txtDays(Index + 7).ForeColor Then
                MovePreviousOrNextMonth Index, 7
            Else
                txtDays(Index + 7).SetFocus
            End If
            
        Case vbKeyUp:
            If &H808080 = txtDays(Index - 7).ForeColor Then
                MovePreviousOrNextMonth Index, -7
            Else
                txtDays(Index - 7).SetFocus
            End If
            
        Case vbKeyLeft:
            If &H808080 = txtDays(Index - 1).ForeColor Then
                MovePreviousOrNextMonth Index, -1
            Else
                txtDays(Index - 1).SetFocus
            End If
                        
End Select

End Sub

Public Property Get SelectionResult() As Long
    SelectionResult = m_result
End Property

Public Property Let SelectionResult(ByVal lNewValue As Long)
    m_result = lNewValue
End Property

Public Function UpdateCalendar(ByVal dDate As Date) As Boolean
Dim lRt As Long
Dim sTmpDate
Dim LastDay As Variant
Dim FirstDay As Variant
Dim ThisDate As Variant
Dim sFirstDayOfWeek As String

MaxDay = Day(dDate)
'First year
lRt = FindItemListControl(cboYear, CStr(Year(dDate)))
If -1 <> lRt Then cboYear.ListIndex = lRt

'Then Month
lRt = FindItemListControl(cboMonth, Format$(dDate, "mmmm"))
If -1 <> lRt Then cboMonth.ListIndex = lRt
    
ThisDate = DateValue(dDate)
FirstDay = MonthBegin(ThisDate)
sFirstDayOfWeek = WeekDay(FirstDay)
    
LastDay = MonthEnd(ThisDate)
ReDrawDayOfWeek CInt(sFirstDayOfWeek) - 1, Day(LastDay), CDate(FirstDay)
SetFocusToDay
UpdateCaption
m_loading = False
    
End Function

Public Function FindItemListControl(ByVal oControl As Object, ByVal sText As String) As Long
' Constants for API calls
Const LB_SETTABSTOPS = &H192
Const CB_FINDSTRING = &H14C
Const LB_FINDSTRING = &H18F
Const CB_FINDSTRINGEXACT = &H158

Dim sTemp As String

sTemp = sText
If TypeOf oControl Is ListBox Then
    FindItemListControl = SendMessage(oControl.hwnd, LB_FINDSTRING, -1, ByVal sTemp)
ElseIf TypeOf oControl Is ComboBox Then
    FindItemListControl = SendMessage(oControl.hwnd, CB_FINDSTRING, -1, ByVal sTemp)
End If

End Function

'Create a new function called MonthBegin. Add the following code to this function:
Function MonthBegin(vbdate As Variant) As Variant
    MonthBegin = DateSerial(Year(vbdate), Month(vbdate), 1)
End Function

'Create a new function called MonthEnd. Add the following code to this function:
Function MonthEnd(vbdate As Variant) As Variant
    MonthEnd = DateSerial(Year(vbdate), Month(vbdate) + 1, 0)
End Function

Function ReDrawDayOfWeek(ByVal lFirstIndex As Long, ByVal lLastNumericDayofMonth As Long, dFirstDayOfMonth As Date) As Boolean

Dim lLoop As Long
Dim dDate As Date

For lLoop = txtDays.LBound To txtDays.UBound
    dDate = DateAdd("d", lLoop - lFirstIndex, dFirstDayOfMonth)
    txtDays(lLoop).Text = CStr(Day(dDate))
    txtDays(lLoop).ForeColor = &H0&
    If lLoop < 7 Then
        If CInt(Day(dDate)) > 8 Then
            txtDays(lLoop).ForeColor = &H808080 ' Light colour
        End If
    End If
    If lLoop > 28 Then
        If CInt(Day(dDate)) < 20 Then
            txtDays(lLoop).ForeColor = &H808080 ' Light colour
        End If
    End If
Next
    
End Function

Public Property Get MaxDate() As Date
    MaxDate = m_date
End Property

Public Property Let MaxDate(ByVal dNewValue As Date)
    m_date = dNewValue
End Property

Private Function UpdateCaption() As Boolean
    Me.Caption = Format$(MaxDate, "mmmm dd, yyyy")
End Function

Public Property Get MaxDay() As Long
    MaxDay = m_day
End Property

Public Property Let MaxDay(ByVal lNewValue As Long)
On Local Error Resume Next
    m_day = lNewValue
    MaxDate = CDate(cboYear.Text & "-" & cboMonth.Text & "-" & m_day)
End Property

Private Sub SetFocusToDay()
Dim iLoop As Long
On Local Error Resume Next

' txtdays that current supports tabstop
txtDays(tabstopindex).TabStop = False
txtDays(tabstopindex).BorderStyle = 0
        
For iLoop = txtDays.LBound To txtDays.UBound
  If IsNumeric(txtDays(iLoop).Text) Then
  
  If MaxDay > 24 Then
    If iLoop >= 7 Then
    If Int(txtDays(iLoop).Text) = MaxDay Then
        txtDays(iLoop).TabStop = True
        tabstopindex = iLoop
        txtDays(iLoop).BorderStyle = 1
        tabstopindex = iLoop
        Debug.Print ActiveControl.Name
        If ActiveControl.Name = "txtDays" Then
            txtDays(iLoop).SetFocus
        End If
        Exit For
    End If
    End If
  Else
    If Int(txtDays(iLoop).Text) = MaxDay Then
        txtDays(iLoop).TabStop = True
        tabstopindex = iLoop
        txtDays(iLoop).BorderStyle = 1
        tabstopindex = iLoop
        Debug.Print ActiveControl.Name
        If ActiveControl.Name = "txtDays" Then
            txtDays(iLoop).SetFocus
        End If
        Exit For
    End If
   End If
  End If
Next
End Sub

Private Property Get tabstopindex() As Long
    tabstopindex = m_tabstop
End Property

Private Property Let tabstopindex(ByVal lNewValue As Long)
    m_tabstop = lNewValue
End Property

Private Function MovePreviousOrNextMonth(ByVal lControlIndex As Long, ByVal lMoveAmount) As Boolean
' -----------------------------------------------------------------------
' MovePreviousOrNextMonth
'
' NOTE: An error will occur if moving to an month that has more days then the
' current month.
' Example, when moving from Nov to October 31, attempting to minus one month
' from Nov 31 will fail.
' -----------------------------------------------------------------------------
On Local Error GoTo Move_Error

Dim dDate As Date

If Val(txtDays(lControlIndex + lMoveAmount).Text) > 28 Then
'
If cboMonth.ListIndex <> 0 Then
    dDate = CDate(Format$(cboYear.Text & "-" & CStr(cboMonth.ListIndex) & "-" & txtDays(lControlIndex + lMoveAmount).Text))
Else
    dDate = CDate(Format$(CStr(Val(cboYear.Text) - 1) & "-12-" & txtDays(lControlIndex + lMoveAmount).Text))
End If
Else
If Val(txtDays(lControlIndex + lMoveAmount).Text) > 10 Then
    dDate = DateAdd("m", -1, CDate(cboYear.Text & "-" & cboMonth.Text & "-" & txtDays(lControlIndex + lMoveAmount).Text))
Else
    dDate = DateAdd("m", 1, CDate(cboYear.Text & "-" & cboMonth.Text & "-" & txtDays(lControlIndex + lMoveAmount).Text))
End If
End If
UpdateCalendar (dDate)

Exit Function
Move_Error:
'MsgBox Err.Description
Err.Clear

End Function
